# 统计页面修复总结

## 修复的问题

### 1. 分销商排行表格切换不正常
**问题描述**: 点击"销售额/订单数"切换时，图表不更新

**解决方案**:
- 在 `StatisticsEnhanced.vue` 添加了 `watch(distributorRankType)` 监听器
- 修改 `loadDistributorRank` 函数，添加调试日志和数据验证
- 优化 `initDistributorRankChart` 函数的数据处理逻辑

### 2. 数据详情表格显示全是0
**问题描述**: 表格中的利润、佣金、转化率等字段都显示为0

**解决方案**:
- 修改 `statistics_service.go` 的 `GetDetailData` 方法
- 返回类型改为 `[]map[string]interface{}` 以支持灵活的数据结构
- 为每种表格类型添加了相应的计算字段：
  - 按日统计: 新客户数、转化率、利润、利润率
  - 按分销商: 佣金、转化率、占比、状态
  - 按商品: 成本、利润、均价、利润率、销售占比
  - 按门店: 活跃度、销售占比等

### 3. 缺少测试数据
**问题描述**: 数据库中订单数据太少，无法测试各种场景

**解决方案**:
创建了多个测试数据生成脚本：
- `create_test_orders_v2.go`: 生成152个跨30天的订单
- `create_store_stats_orders.go`: 生成多门店的订单数据
- `check_orders_data.go`: 检查订单数据分布

## 使用方法

### 1. 生成测试数据
```bash
# 生成基础测试订单
cd backend/scripts
go run create_test_orders_v2.go

# 生成多门店测试数据
go run create_store_stats_orders.go

# 检查数据分布
go run check_orders_data.go
```

### 2. 测试功能
1. 访问 `/statistics` 页面
2. 测试分销商排行切换：
   - 点击"销售额"按钮，查看销售额排行
   - 点击"订单数"按钮，查看订单数排行
3. 测试数据详情表格：
   - 切换"按日统计"查看每日数据
   - 切换"按分销商"查看分销商数据
   - 切换"按商品"查看商品销售数据
   - 切换"按门店"查看门店数据

## 注意事项

1. **后端数据计算**
   - 目前利润率、佣金率等使用固定值（30%利润率，10%佣金率）
   - 实际项目中应从数据库配置或商品信息中获取

2. **门店统计**
   - 目前使用模拟数据
   - 需要实现真实的门店统计查询方法

3. **性能优化**
   - 大量数据时可能需要分页
   - 考虑添加缓存机制

4. **前端优化建议**
   - 移除不必要的调试日志
   - 优化移动端显示效果

## 后续改进建议

1. 实现真实的成本、利润计算
2. 添加门店维度的统计查询
3. 实现数据导出功能（Excel/PDF）
4. 添加更多的数据可视化图表
5. 优化大数据量下的查询性能