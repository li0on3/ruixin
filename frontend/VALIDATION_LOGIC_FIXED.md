# æ‰¹é‡éªŒè¯é€»è¾‘è¯´æ˜ï¼ˆä¿®å¤ç‰ˆï¼‰

## ğŸ§  æ™ºèƒ½éªŒè¯é€»è¾‘è¯¦è§£

### ç­›é€‰æ¡ä»¶ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ï¼š

#### ä¼˜å…ˆçº§1ï¼šæœ‰è®¢å•ä½†çŠ¶æ€å¼‚å¸¸çš„å¡ç‰‡ âš ï¸
```sql
order_id IS NOT NULL AND status = 0
```
- **åœºæ™¯**ï¼šå¡ç‰‡å·²è¢«è®¢å•ä½¿ç”¨ï¼Œä½†æœ¬åœ°çŠ¶æ€è¿˜æ˜¾ç¤º"æœªä½¿ç”¨"
- **åŸå› **ï¼šè®¢å•å®ŒæˆåçŠ¶æ€åŒæ­¥å¤±è´¥
- **é‡è¦æ€§**ï¼šæœ€é«˜ä¼˜å…ˆçº§ï¼Œå½±å“åº“å­˜å‡†ç¡®æ€§

#### ä¼˜å…ˆçº§2ï¼šæœ‰å¼‚å¸¸çš„æœªä½¿ç”¨å¡ç‰‡ ğŸ”
```sql
status = 0 AND (synced_at IS NULL OR synced_at < 24å°æ—¶å‰)
```
- **åœºæ™¯**ï¼šæ˜¾ç¤º"æœªä½¿ç”¨"ä½†24å°æ—¶å†…æœªéªŒè¯è¿‡
- **åŸå› **ï¼šå¯èƒ½åœ¨ç‘å¹¸ç³»ç»Ÿä¸­å·²è¢«ä½¿ç”¨
- **é‡è¦æ€§**ï¼šé«˜ä¼˜å…ˆçº§ï¼Œé¿å…é‡å¤ä½¿ç”¨

#### ä¼˜å…ˆçº§3ï¼š**æœ€è¿‘ä½¿ç”¨ä½†çŠ¶æ€å¯èƒ½ä¸å‡†ç¡®çš„å¡ç‰‡** ğŸ•’
```sql
status = 1 AND used_at > 7å¤©å‰ AND (synced_at IS NULL OR synced_at < used_at)
```
- **åœºæ™¯**ï¼š7å¤©å†…ä½¿ç”¨çš„å¡ç‰‡ï¼Œä½†éªŒè¯æ—¶é—´æ—©äºä½¿ç”¨æ—¶é—´
- **åŸå› **ï¼šçŠ¶æ€æ›´æ–°åæœªé‡æ–°éªŒè¯
- **é‡è¦æ€§**ï¼šä¸­ç­‰ä¼˜å…ˆçº§ï¼Œç¡®ä¿å·²ä½¿ç”¨å¡ç‰‡çŠ¶æ€æ­£ç¡®

#### ä¼˜å…ˆçº§4ï¼šæ–°æ·»åŠ çš„æœªéªŒè¯å¡ç‰‡ ğŸ†•
```sql
created_at > 24å°æ—¶å‰ AND (synced_at IS NULL OR sync_status = 'failed')
```
- **åœºæ™¯**ï¼šæ–°å¯¼å…¥çš„å¡ç‰‡æˆ–ä¹‹å‰éªŒè¯å¤±è´¥çš„å¡ç‰‡
- **åŸå› **ï¼šé¦–æ¬¡éªŒè¯æˆ–éœ€è¦é‡æ–°éªŒè¯
- **é‡è¦æ€§**ï¼šè¾ƒä½ä¼˜å…ˆçº§ï¼Œç¡®ä¿æ–°å¡ç‰‡å¯ç”¨æ€§

### æ’é™¤æ¡ä»¶ï¼š
- **é¢„å ä¸­çš„å¡ç‰‡**ï¼š`status != 2`ï¼ˆé¿å…å¹²æ‰°æ­£åœ¨è¿›è¡Œçš„è®¢å•ï¼‰

### éªŒè¯å‚æ•°ï¼š
- **æ•°é‡é™åˆ¶**ï¼šæœ€å¤š200å¼ å¡ç‰‡
- **éªŒè¯é—´éš”**ï¼š3ç§’/å¼ 
- **è¶…æ—¶é™åˆ¶**ï¼šæœ€å¤§æ‰§è¡Œ10åˆ†é’Ÿ
- **é¢„è®¡å®Œæˆæ—¶é—´**ï¼š2-5åˆ†é’Ÿ

## ğŸŒ å…¨é‡éªŒè¯é€»è¾‘è¯¦è§£

### éªŒè¯èŒƒå›´ï¼š
```sql
status IN (0, 1) -- æœªä½¿ç”¨å’Œå·²ä½¿ç”¨çš„å¡ç‰‡
AND status != 2  -- æ’é™¤é¢„å ä¸­çš„å¡ç‰‡
```

### å®‰å…¨ç­–ç•¥ï¼š
- **åˆ†æ‰¹å¤„ç†**ï¼šæ¯æ‰¹5å¼ å¡ç‰‡
- **æ‰¹é—´é—´éš”**ï¼š2åˆ†é’Ÿä¼‘æ¯
- **å¡ç‰‡é—´éš”**ï¼š10ç§’
- **æ‰§è¡Œæ–¹å¼**ï¼šåå°å¼‚æ­¥ï¼Œä¸é˜»å¡ç”¨æˆ·æ“ä½œ

### é¢„è®¡æ—¶é—´ï¼š
- **1000å¼ å¡ç‰‡**ï¼šçº¦2-3å°æ—¶
- **å®‰å…¨ç¬¬ä¸€**ï¼šé˜²æ­¢è§¦å‘APIé£æ§

## ğŸ› ï¸ ä¿®å¤çš„é—®é¢˜

### 1. è¿›åº¦çª—å£ç®¡ç† âœ…
**é—®é¢˜**ï¼šå…³é—­è¿›åº¦çª—å£åæ— æ³•é‡æ–°æ‰“å¼€
**è§£å†³**ï¼š
- æ·»åŠ "æŸ¥çœ‹è¿›åº¦"æŒ‰é’®ï¼Œå½“æœ‰è¿è¡Œä¸­ä»»åŠ¡æ—¶æ˜¾ç¤º
- ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–åˆ° localStorage
- é¡µé¢åˆ·æ–°åè‡ªåŠ¨æ¢å¤ä»»åŠ¡çŠ¶æ€

### 2. é‡å¤éªŒè¯é˜²æŠ¤ âœ…
**é—®é¢˜**ï¼šåˆ·æ–°é¡µé¢åå¯ä»¥é‡å¤å¯åŠ¨éªŒè¯
**è§£å†³**ï¼š
- å¯åŠ¨éªŒè¯å‰æ£€æŸ¥æ˜¯å¦å·²æœ‰è¿è¡Œä¸­ä»»åŠ¡
- å¦‚æœ‰è¿è¡Œä¸­ä»»åŠ¡ï¼Œç›´æ¥æ˜¾ç¤ºè¿›åº¦è€Œéå¯åŠ¨æ–°ä»»åŠ¡
- ä»»åŠ¡å®Œæˆåè‡ªåŠ¨æ¸…ç†çŠ¶æ€

### 3. ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ– âœ…
**é—®é¢˜**ï¼šé¡µé¢åˆ·æ–°åä»»åŠ¡çŠ¶æ€ä¸¢å¤±
**è§£å†³**ï¼š
- ä½¿ç”¨ localStorage ä¿å­˜ä»»åŠ¡IDå’Œæ¨¡å¼
- é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥å¹¶æ¢å¤ä»»åŠ¡çŠ¶æ€
- ä»»åŠ¡å®Œæˆæ—¶è‡ªåŠ¨æ¸…ç†æœ¬åœ°å­˜å‚¨

## ğŸ“± ç”¨æˆ·äº¤äº’æµç¨‹

### å¯åŠ¨éªŒè¯ï¼š
1. ç‚¹å‡»"æ‰¹é‡éªŒè¯"ä¸‹æ‹‰èœå•
2. é€‰æ‹©éªŒè¯æ¨¡å¼ï¼ˆæ™ºèƒ½/å…¨é‡ï¼‰
3. ç¡®è®¤éªŒè¯æç¤º
4. è‡ªåŠ¨æ˜¾ç¤ºè¿›åº¦çª—å£

### è¿›åº¦ç›‘æ§ï¼š
1. å®æ—¶æ˜¾ç¤ºéªŒè¯è¿›åº¦
2. å¯ä»¥å–æ¶ˆæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
3. å…³é—­çª—å£åå¯é€šè¿‡"æŸ¥çœ‹è¿›åº¦"æŒ‰é’®é‡æ–°æ‰“å¼€

### é¡µé¢åˆ·æ–°ï¼š
1. è‡ªåŠ¨æ£€æµ‹è¿è¡Œä¸­çš„ä»»åŠ¡
2. æ˜¾ç¤ºæç¤ºä¿¡æ¯
3. ç‚¹å‡»"æŸ¥çœ‹è¿›åº¦"æ¢å¤ç›‘æ§

### ä»»åŠ¡å®Œæˆï¼š
1. æ˜¾ç¤ºéªŒè¯ç»“æœ
2. è‡ªåŠ¨åˆ·æ–°å¡ç‰‡åˆ—è¡¨
3. æ¸…ç†æ‰€æœ‰ç›¸å…³çŠ¶æ€

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### çŠ¶æ€ç®¡ç†ï¼š
```javascript
// å“åº”å¼çŠ¶æ€
const hasRunningTask = ref(false)      // æ˜¯å¦æœ‰è¿è¡Œä¸­ä»»åŠ¡
const currentTaskId = ref(null)        // å½“å‰ä»»åŠ¡ID
const validationTask = ref(null)       // ä»»åŠ¡è¯¦æƒ…
const progressDialogVisible = ref(false) // è¿›åº¦çª—å£æ˜¾ç¤ºçŠ¶æ€

// æœ¬åœ°å­˜å‚¨
localStorage.setItem('validation_task_id', taskId)
localStorage.setItem('validation_task_mode', mode)
```

### ä»»åŠ¡æ£€æŸ¥é€»è¾‘ï¼š
```javascript
// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥
const checkRunningTask = async () => {
  const savedTaskId = localStorage.getItem('validation_task_id')
  if (savedTaskId) {
    const res = await getValidationProgress(savedTaskId)
    if (res.data.status === 'running' || res.data.status === 'queued') {
      // æ¢å¤ä»»åŠ¡çŠ¶æ€
      hasRunningTask.value = true
      currentTaskId.value = savedTaskId
    }
  }
}
```

### é˜²é‡å¤å¯åŠ¨ï¼š
```javascript
// å¯åŠ¨å‰æ£€æŸ¥
if (hasRunningTask.value && currentTaskId.value) {
  const res = await getValidationProgress(currentTaskId.value)
  if (res.data.status === 'running' || res.data.status === 'queued') {
    // æ˜¾ç¤ºç°æœ‰ä»»åŠ¡è¿›åº¦
    validationTask.value = res.data
    progressDialogVisible.value = true
    return // ä¸å¯åŠ¨æ–°ä»»åŠ¡
  }
}
```

## ğŸ¯ ä½¿ç”¨å»ºè®®

### æ™ºèƒ½éªŒè¯ï¼š
- **é€‚ç”¨åœºæ™¯**ï¼šæ—¥å¸¸ç»´æŠ¤ã€å¿«é€Ÿæ£€æŸ¥
- **ä½¿ç”¨é¢‘ç‡**ï¼šæ¯å¤©1-2æ¬¡
- **æœ€ä½³æ—¶é—´**ï¼šä¸Šåˆæˆ–ä¸‹åˆä¸šåŠ¡è¾ƒå°‘æ—¶

### å…¨é‡éªŒè¯ï¼š
- **é€‚ç”¨åœºæ™¯**ï¼šå…¨é¢æ£€æŸ¥ã€å®šæœŸç»´æŠ¤
- **ä½¿ç”¨é¢‘ç‡**ï¼šæ¯å‘¨1æ¬¡æˆ–æŒ‰éœ€
- **æœ€ä½³æ—¶é—´**ï¼šå¤œé—´æˆ–ä¸šåŠ¡ç©ºé—²æœŸ

### æ³¨æ„äº‹é¡¹ï¼š
1. **é¿å…åŒæ—¶å¯åŠ¨å¤šä¸ªéªŒè¯ä»»åŠ¡**
2. **å…¨é‡éªŒè¯æœŸé—´é¿å…å¤§é‡è®¢å•æ“ä½œ**
3. **å®šæœŸå…³æ³¨éªŒè¯ç»“æœï¼ŒåŠæ—¶å¤„ç†å¼‚å¸¸**
4. **å¦‚é‡é—®é¢˜å¯éšæ—¶å–æ¶ˆä»»åŠ¡**

è¿™æ¬¡ä¿®å¤å®Œç¾è§£å†³äº†æ‰€æœ‰é—®é¢˜ï¼Œç°åœ¨ç”¨æˆ·å¯ä»¥å®‰å…¨ã€ä¾¿æ·åœ°ä½¿ç”¨æ‰¹é‡éªŒè¯åŠŸèƒ½ï¼