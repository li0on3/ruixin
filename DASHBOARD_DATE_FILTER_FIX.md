# 仪表盘日期过滤功能修复

## 问题描述
1. 用户报告：在仪表盘页面选择日期范围后，显示的数据没有根据所选日期范围更新，仍然显示之前的数据。
2. 销售趋势分析图表有两个日期控制器（顶部全局日期选择器和图表内的时间周期选择器），存在冲突。

## 问题分析
1. 前端已经将日期参数传递给 API 调用
2. 但后端的 Dashboard API (`/admin/dashboard/*`) 没有实现日期参数支持
3. 只有 Statistics API (`/admin/statistics/*`) 支持日期参数
4. 销售趋势图表的时间周期选择器（7天、30天、90天）与顶部日期选择器逻辑冲突

## 解决方案

### 后端修改

#### 1. 修改 Dashboard Handler (admin_dashboard_handler.go)
- 为所有 API 端点添加日期参数支持：
  - `GetStatistics` - 添加 `start_date` 和 `end_date` 参数
  - `GetHotGoods` - 添加 `start_date` 和 `end_date` 参数
  - `GetRecentOrders` - 添加 `start_date` 和 `end_date` 参数

#### 2. 修改 Dashboard Service (dashboard_service.go)
- 添加新方法支持日期范围查询：
  - `GetStatisticsWithDateRange` - 根据日期范围获取统计数据
  - `GetHotGoodsWithDateRange` - 根据日期范围获取热门商品
  - `GetRecentOrdersWithDateRange` - 根据日期范围获取最新订单
- 日期范围统计增加了增长率计算（与前一个相同时长比较）
- 返回数据中包含日期范围标签，便于前端显示

### 前端修改

#### 1. 修改 DashboardPremium.vue
- 确保所有 API 调用都传递日期参数
- 修改 `updateCoreMetrics` 函数，根据日期范围动态调整指标标题
- 为商品分布图表添加空数据状态显示

#### 2. 修复销售趋势图表的日期逻辑
- 修改 `initTrendChart` 函数，支持两种日期选择方式：
  - 当用户选择图表内的时间周期（7天、30天、90天）时，使用该值计算日期范围
  - 当用户使用顶部日期选择器时，使用选择的日期范围，并清空时间周期选择
- 添加 `trendStats` 计算逻辑，实时更新最高值、平均值和增长率
- 修改 `handleDateChange`，当使用顶部日期选择器时清空 `trendPeriod` 值

#### 3. 修复图表类型选择器功能
- 根据 `trendChartType` 的值（revenue/orders/profit）切换显示不同的数据
- 销售额：显示销售金额数据
- 订单量：显示订单数量数据
- 利润：基于销售额计算（假设30%利润率）
- 根据不同的图表类型：
  - 调整Y轴标签和单位
  - 调整统计数据的格式化显示
  - 使用不同的颜色主题
- 添加 `formatTrendStatValue` 函数，根据图表类型格式化统计值

## 技术细节

### 日期处理
- 日期格式：`YYYY-MM-DD`
- 结束日期自动调整为当天的 23:59:59
- 如果没有提供日期参数，默认返回今日数据

### 增长率计算
- 与前一个相同时长的数据进行比较
- 例如：选择 7 天，则与前 7 天比较
- 如果没有历史数据，增长率为 0

### 空数据处理
- 所有图表都添加了空数据状态显示
- 显示"暂无数据"提示，而不是显示旧数据

## 测试建议

1. 选择不同的日期范围，验证数据是否正确更新
2. 选择没有数据的日期，验证是否显示空状态
3. 验证增长率计算是否正确
4. 检查所有图表（趋势图、商品分布、时段分析）是否正确响应日期变化
5. 测试销售趋势图表的两种日期控制方式：
   - 使用图表内的时间周期选择器（7天、30天、90天）
   - 使用顶部的日期选择器
   - 验证两种方式不会冲突

## 注意事项

1. 分销商和卡片统计不受日期范围影响（显示当前实时数据）
2. 核心指标的字段名保持不变（`todayOrders`、`todayAmount`）以保持向后兼容
3. 日期范围标签会根据选择动态调整（今日、单日、日期范围）